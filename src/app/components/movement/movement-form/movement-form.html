<div class="movement-form-container">
  <div class="page-header">
    <h1 class="page-title">{{ typeLabel }}</h1>
    <p class="page-subtitle">
      {{ movementType === 'IN' 
        ? 'Registra productos que ingresan al inventario' 
        : 'Registra productos que salen del inventario' 
      }}
    </p>
  </div>

  <div class="card form-card">
    <form [formGroup]="form" (ngSubmit)="submit()">
      <div class="form-section">
        <div class="form-group">
          <label>Producto <span class="required">*</span></label>
          <select formControlName="productId">
            <option value="">Selecciona un producto</option>
            <option *ngFor="let p of products" [value]="p.id">
              {{ p.name }} (Stock: {{ p.stock }})
            </option>
          </select>
          @if (form.controls.productId.invalid && form.controls.productId.touched) {
            <div class="error">
              Debes seleccionar un producto
            </div>
          }
        </div>

        <div class="form-group">
          <label>Cantidad <span class="required">*</span></label>
          <input 
            type="number" 
            formControlName="amount"
            placeholder="0"
            min="1"
          />
          <span class="hint">
            {{ movementType === 'IN' 
              ? 'Cantidad de unidades que ingresan' 
              : 'Cantidad de unidades que salen' 
            }}
          </span>
          @if (form.controls.amount.invalid && form.controls.amount.touched) {
            <div class="error">
              La cantidad debe ser mayor a 0
            </div>
          }
        </div>

        <div class="form-group">
          <label>Notas</label>
          <textarea 
            formControlName="notes"
            rows="3"
            placeholder="InformaciÃ³n adicional sobre este movimiento (opcional)..."
          ></textarea>
        </div>
      </div>

      @if (selectedProduct) {
        <div class="movement-preview">
          <div class="preview-header">
            <h3>Resumen del movimiento</h3>
          </div>
          <div class="preview-content">
            <div class="preview-item">
              <span class="preview-label">Producto:</span>
              <strong>{{ selectedProduct.name }}</strong>
            </div>
            <div class="preview-item">
              <span class="preview-label">Stock actual:</span>
              <strong>{{ selectedProduct.stock }} unidades</strong>
            </div>
            <div class="preview-item">
              <span class="preview-label">Cantidad del movimiento:</span>
              <strong 
                [class.amount-in]="movementType === 'IN'"
                [class.amount-out]="movementType === 'OUT'"
              >
                {{ movementType === 'IN' ? '+' : '-' }}{{ form.value.amount || 0 }}
              </strong>
            </div>
            <div class="preview-item preview-total">
              <span class="preview-label">Nuevo stock:</span>
              <strong>{{ calculateNewStock() }} unidades</strong>
            </div>
          </div>
        </div>
      }

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn"
          [class.btn-primary]="movementType === 'OUT'"
          [class.btn-outline]="movementType === 'IN'"
          [disabled]="form.invalid"
        >
          {{ typeLabel }}
        </button>
        <button 
          type="button" 
          class="btn btn-ghost"
          (click)="cancel()"
        >
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>