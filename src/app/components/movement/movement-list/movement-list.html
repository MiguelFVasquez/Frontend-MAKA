<div class="movement-list-container">
  <div class="page-header">
    <h1 class="page-title">Movimientos</h1>
    <p class="page-subtitle">Historial de entradas y salidas de inventario</p>
  </div>

  <div class="toolbar">
    <div class="filter-group">
      <select 
        [formControl]="typeFilter" 
        class="filter-select"
      >
        <option value="">Todos los tipos</option>
        <option value="IN">Entradas</option>
        <option value="OUT">Salidas</option>
      </select>
      <input 
        type="date" 
        [formControl]="dateFilter"
        class="filter-date"
        placeholder="Fecha"
      />
      @if (typeFilter.value || dateFilter.value) {
        <button 
          class="btn btn-ghost btn-sm" 
          (click)="clearFilters()"
        >
          Limpiar filtros
        </button>
      }
    </div>
    
    <div class="action-buttons">
      <a class="btn btn-outline" routerLink="/movements/in">
        ↑ Nueva Entrada
      </a>
      <a class="btn btn-primary" routerLink="/movements/out">
        ↓ Nueva Salida
      </a>
    </div>
  </div>

  <!-- Loading state -->
  @if (isLoading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando movimientos...</p>
    </div>
  }

  <!-- Error state -->
  @if (errorMessage) {
    <div class="error-state">
      <p>❌ {{ errorMessage }}</p>
      <button class="btn btn-outline" (click)="loadMovements()">
        Reintentar
      </button>
    </div>
  }

  <!-- Movements table -->
  @if (!isLoading && !errorMessage) {
    <div class="card">
      <table class="table">
        <thead>
          <tr>
            <th>Fecha y Hora</th>
            <th>Producto</th>
            <th>Tipo</th>
            <th>Cantidad</th>
            <th>Usuario</th>
          </tr>
        </thead>
        <tbody>
          @for (movement of filteredMovements; track movement.id) {
            <tr>
              <td>
                <div class="date-cell">
                  <strong>{{ movement.date_mxove | date: 'dd/MM/yyyy' }}</strong>
                  <span class="time">{{ movement.date_mxove | date: 'HH:mm' }}</span>
                </div>
              </td>
              <td>{{ movement.productName }}</td>
              <td>
                <span 
                  class="badge"
                  [class.badge-success]="movement.typeMove === 'IN'"
                  [class.badge-warning]="movement.typeMove === 'OUT'"
                >
                  {{ movement.typeMove === 'IN' ? '↑ Entrada' : '↓ Salida' }}
                </span>
              </td>
              <td>
                <span 
                  [class.amount-in]="movement.typeMove === 'IN'"
                  [class.amount-out]="movement.typeMove === 'OUT'"
                >
                  {{ movement.typeMove === 'IN' ? '+' : '-' }}{{ movement.amount }}
                </span>
              </td>
              <td>{{ movement.user || 'Sistema' }}</td>
            </tr>
          }
          @if (filteredMovements.length === 0) {
            <tr>
              <td colspan="5" class="empty-state">
                <div>
                  <p>{{ getEmptyMessage() }}</p>
                  @if (!typeFilter.value && !dateFilter.value) {
                    <div class="empty-actions">
                      <a routerLink="/movements/in" class="btn btn-outline">
                        Registrar entrada
                      </a>
                      <a routerLink="/movements/out" class="btn btn-outline">
                        Registrar salida
                      </a>
                    </div>
                  } @else {
                    <button class="btn btn-outline" (click)="clearFilters()">
                      Limpiar filtros
                    </button>
                  }
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>

    <!-- Stats -->
    @if (movements.length > 0) {
      <div class="stats-footer">
        <span class="stat-item">
          Total: <strong>{{ movements.length }}</strong>
        </span>
        @if (typeFilter.value || dateFilter.value) {
          <span class="stat-item">
            Mostrando: <strong>{{ filteredMovements.length }}</strong>
          </span>
        }
        <span class="stat-item">
          Entradas: <strong>{{ countMovementsByType('IN') }}</strong>
        </span>
        <span class="stat-item">
          Salidas: <strong>{{ countMovementsByType('OUT') }}</strong>
        </span>
      </div>
    }
    </div>
  }
</div>