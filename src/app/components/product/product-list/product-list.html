<div class="product-list-container">
  <div class="page-header">
    <h1 class="page-title">Productos</h1>
    <p class="page-subtitle">Gestiona tu inventario de productos</p>
  </div>

  <div class="toolbar">
    <div class="search-group">
      <input 
        [formControl]="searchControl" 
        placeholder="Buscar por nombre o referencia..."
        class="search-input"
      />
    </div>

    <div class="filter-group">
      <select 
        [formControl]="statusFilter" 
        class="status-filter"
      >
        <option value="">Todos los estados</option>
        <option value="ACTIVO">Activos</option>
        <option value="INACTIVO">Inactivos</option>
        <option value="REPOSICION">Reposición</option>
      </select>

      <a class="btn btn-primary" routerLink="/products/new">
        <span>+ Nuevo Producto</span>
      </a>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando productos...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="errorMessage" class="error-state">
    <p>❌ {{ errorMessage }}</p>
    <button class="btn btn-outline" (click)="loadProducts()">
      Reintentar
    </button>
  </div>

  <!-- Products table -->
  <div *ngIf="!isLoading && !errorMessage" class="card">
    <table class="table">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Referencia</th>
          <th>Stock</th>
          <th>Precio Venta</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of filteredProducts">
          <td>
            <div class="product-name">
              <strong>{{ p.name }}</strong>
              <span class="product-desc" *ngIf="p.description">
                {{ p.description }}
              </span>
            </div>
          </td>
          <td>{{ p.reference || '-' }}</td>
          <td>
            <span 
              [class.stock-low]="p.stock < p.stock_minimo"
              [class.stock-ok]="p.stock >= p.stock_minimo"
            >
              {{ p.stock }}
            </span>
          </td>
          <td>{{ p.sale_price | currency:'COP':'symbol-narrow':'1.0-0' }}</td>
          <td>
            <span 
              class="badge"
              [class.badge-success]="p.status.status === 'ACTIVO'"
              [class.badge-warning]="p.status.status === 'INACTIVO'"
              [class.badge-accent]="p.status.status === 'REPOSICION'"
            >
              {{ p.status.status }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <a 
                [routerLink]="['/products', p.id]" 
                class="btn-ghost btn-sm"
              >
                Editar
              </a>
              <button 
                class="btn-danger btn-sm"
                (click)="deleteProduct(p)"
                [disabled]="deletingProductId === p.id"
              >
                <span *ngIf="deletingProductId === p.id">Eliminando...</span>
                <span *ngIf="deletingProductId !== p.id">Eliminar</span>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="filteredProducts.length === 0">
          <td colspan="6" class="empty-state">
            <div>
              <p>{{ getEmptyMessage() }}</p>
              <a routerLink="/products/new" class="btn btn-outline">
                Crear primer producto
              </a>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Stats -->
    <div class="stats-footer">
      <span class="stat-item">
        Total: <strong>{{ products.length }}</strong>
      </span>
      <span class="stat-item" *ngIf="searchControl.value || statusFilter.value">
        Mostrando: <strong>{{ filteredProducts.length }}</strong>
      </span>
    </div>
  </div>
</div>